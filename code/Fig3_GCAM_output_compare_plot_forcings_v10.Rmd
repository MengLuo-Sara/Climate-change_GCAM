---
title: "try_RGCAM"
author: "Meng"
date: "2023-09-25"
output: html_document
---


### content

## path variable prepare 
 S1 set path and install package
 S2 variable, scenario list prepare
## read and process input data 
 S3 function save_result  & process input data
 S4 read & process input table
## plotting functions
 S5_1 function plot each land use fig first, then group them
 S5_2 function fig plotting & saving
## plotting
### agg land use 
#### only gfdl& agg land types
 S6 aggregated.land.allocation process 2 for plotting  SSP370 & SSP126 & SSP585
 S7 use the processed data for plotting
#### plotting agg land use only for SSP585
 S8 aggregated.land.allocation plotting  SSP585
### total climate forcing 
#### only gfdl
 S9 total.climate.forcing_SSP_combines plotting SSP370&SSP126& SSP585
 S10 total.climate.forcing_SSP_combines plotting SSP370&SSP126
## old
 S11 read input table old
  
  
  



```{r S0 knit, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:
## path variable prepare ##############################################
```{r S1 set path and install package}

require(devtools)
#Please use this in console if needed: install_github('JGCRI/rgcam', build_vignettes=TRUE, force =TRUE)


library(tidyverse)
library(tidyr)
library(dplyr)
library(ggplot2)
library(patchwork)
library(sf)
library(svglite)
library(cowplot)
library(gridExtra)
library(ggthemes)
library(scales) # for the percentage format on y-axis
library(RColorBrewer)


## chen lab desktop
# root <- "O:/"
## new laptop
root <- "D:/"

version_name <- "_new_agb_bgb_v2"


## database_basexdb/
# output_dir <- paste0(root, "E/Data/", sep='') 
figure_save_path <- paste0(root,"E/new laptop2/PHD/my_2024_1_manuscript/Figure&table/figure/compare_GCAM_out/", sep='') 
in_csv_dir <- paste0(root,"E/new laptop2/PHD/phd_dissertation/climate_FPC_GCAM/Data/GCAM_db_extact_dat/CSV/")

# read shp file
shp_path <- paste0(root, "E/new laptop2/PHD/GCAM/boundary/gcam_boundaries_moirai_3p1_0p5arcmin_wgs84/gcam_boundaries_moirai_3p1_0p5arcmin_wgs84/main_outputs/region_boundaries_moirai_combined_3p1_0p5arcmin.shp")
# plot(data_sf)
data_sf <- st_read(shp_path)




```

```{r S2 variable, scenario list prepare}
# 7 in total
case_names_list <-
  c( 
     ### SSP370 or SSP126
    "v3_ori",
    "v3_classic_gfdl_default_updateall_orifor_fixed",
    "v3_classic_gfdl_default_updateall_fixed",
    "v3_classic_ukesm_default_updateall_orifor_fixed",
    "v3_classic_ukesm_default_updateall_fixed"
    ### SSP585
    # "v3_10_default_updateall_fixed",
    # "v3_10_default_updateall_orifor_fixed",
    # "v3_10",
    # "v3_10_ag_prodchange",
    # "v3_10_ag_cost",
    # "baseline_noRCP",
    # "baseline_noRCP_ag_cost",
    # "baseline_noRCP_ag_prodchange"
  )
case_short_names_list <- c(
  ### SSP370 or SSP126
  "ori",
  "classic_gfdl_default_updateall_orifor",
  "classic_gfdl_default_updateall",
  "classic_ukesm_default_updateall_orifor",
  "classic_ukesm_default_updateall"
    ### SSP585
  # "default_updateall",
  # "default_updateall_orifor",
  # "ori",
  # "ori_ag_prodchange",
  # "ori_ag_cost",
  # "noRCP",
  # "noRCP_ag_cost",
  # "noRCP_ag_prodchange"
)


varlist_1 <-
  c(
    'LUC.emissions.by.region' ,
    'detailed.land.allocation' ,
    'aggregated.land.allocation' ,
    'ag.commodity.prices' ,
    'CO2.concentrations' ,
    'total.climate.forcing' ,
    'global.mean.temperature' ,
    'net.terrestrial.C.uptake' ,
    'CO2.emissions.by.region' ,
    'CO2.emissions.by.sector.excluding.resource.production' ,
    'CO2.sequestration.by.sector' ,
    'CO2.sequestration.by.tech' ,
    'nonCO2.emissions.by.region',
    'nonCO2.emissions.by.sector.excluding.resource.production' ,
    'nonCO2.emissions.by.resource.production',
    ## new added
    'ag.production.by.crop.type',
    'ag.production.by.subsector.land.use.region)',
    'ag.production.by.tech',
    'ag.tech.variable.cost',
    'ag.tech.yield',
    'ag.tech.yield.in.a.specified.land.region'
  )


scenario_sets<-c("SSP126","SSP370","SSP585")
scenario_set<-scenario_sets[3]
SSP_name<-scenario_set
```

## read and process input data #########################################

```{r S3 function save_result  & process input data}
save_csv_result <- function(result_DF, save_file_name,row_names) {
  
  
  full_save_path<-paste0(
    figure_save_path,
    save_file_name,
    version_name,
    ".csv"
  )
  
if (row_names == TRUE) {
write.csv(result_DF,full_save_path, row.names = TRUE)
} else {
write.csv(result_DF,full_save_path, row.names = FALSE)
}

}
#######################################################################
# Define function to read and preprocess data
read_and_preprocess <- function(filename, figure_save_path) {
  read.csv(paste0(figure_save_path, filename,scenario_set,"_combines.csv")) %>%
    dplyr::select(-X)
}

# Define function to aggregate data by land type
aggregate_land_type <- function(data, land_types, new_landleaf) {
  filtered_df <- data %>% filter(landleaf %in% land_types)
  
  summed_df <- filtered_df %>%
    group_by(Units, scenario, region, year) %>%
    summarize(across(ori:classic_ukesm_default_updateall, sum)) %>%
    ungroup() %>%
    mutate(landleaf = new_landleaf) %>%
    select(Units, scenario, region, year, landleaf, everything())
  
  result_df <- data %>%
    filter(!landleaf %in% land_types) %>%
    bind_rows(summed_df) %>%
    arrange(Units, scenario, region, landleaf, year)
  
  return(result_df)
}

# Define function to rename landleaf types
rename_landleaf <- function(data) {
  data %>%
    mutate(landleaf = gsub("pasture \\(other\\)", "Unmanaged pasture", landleaf)) %>%
    mutate(landleaf = gsub("pasture \\(grazed\\)", "Managed pasture", landleaf)) %>%
    mutate(landleaf = gsub("grass", "Grass", landleaf)) %>%
    mutate(landleaf = gsub("shrub", "Shrub", landleaf)) %>%
    mutate(landleaf = gsub("biomass", "Biomass", landleaf))
}



  
```

```{r S4 read & process input table}
# total.climate.forcing_SSP_combines<-read.csv(paste0(figure_save_path,"total.climate.forcing_",scenario_set,"_combines.csv"))%>%
  # total_climate_forcing_SSP_combines <- read_and_preprocess("total.climate.forcing_", figure_save_path)


# Read data
total_climate_forcing_SSP_combines <- read_and_preprocess("total.climate.forcing_", figure_save_path)
aggregated_land_allocation_SSP_combines <- read_and_preprocess("aggregated.land.allocation_", figure_save_path)

# Aggregate data by different land types
aggregated_land_allocation_combines_s2 <- aggregate_land_type(aggregated_land_allocation_SSP_combines, c("crops", "otherarable"), "Cropland")
aggregated_land_allocation_combines_s3 <- aggregate_land_type(aggregated_land_allocation_combines_s2, c("Softwood_Forest", "Hardwood_Forest"), "Managed forest")
aggregated_land_allocation_combines_s4 <- aggregate_land_type(aggregated_land_allocation_combines_s3, c("UnmanagedSoftwood_Forest", "UnmanagedHardwood_Forest"), "Unmanaged forest")
aggregated_land_allocation_combines_s5 <- aggregate_land_type(aggregated_land_allocation_combines_s4, c("rock and desert", "urban", "tundra"), "Other")

# Rename landleaf types
aggregated.land.allocation_combines_s6 <- rename_landleaf(aggregated_land_allocation_combines_s5)

```
## plotting functions ##################################################


```{r S5_2 function fig plotting & saving }


# Ylimits<-c(-19.5,3.5)

# p <- create_time_series_plot_landtype_ylim(long_aggregated.land.allocation_SSP_combines_forrole_diff_re, title_suffix = paste0(" under ", scenario_set, " for role relative Diff"), y_title = "%", y_limits = Ylimits)
##################################
create_time_series_plot_landtype_ylim <- function(data, y_limits = NULL, title_suffix = "", title_main = "Time Series by Landleaf Type", y_title = "Value") {
  
  
  
  ###################
  p <- ggplot(data, aes(x = year, y = value, color = case)) +
    geom_line() +
    facet_wrap(~ landleaf, scales = "free_y") +
    scale_color_brewer(palette = "Dark2", type = "qual", limits = unique(data$case)) +
    theme_minimal() +
    labs(title = paste(title_main, title_suffix),
         x = "Year",
         y = y_title,
         color = "Case") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1),
          plot.title.position = "panel", # Ensures the title is at the top center
          panel.border = element_rect(color = "black", fill = NA, size = 1))
  
  if (!is.null(y_limits)) {
    p <- p + ylim(y_limits)
  }
  
  return(p)
  # # Apply y-limits manually for each facet
  # if (!is.null(y_limits)) {
  #   for (landleafn in unique(data$landleaf)) {
  #     if (landleafn %in% names(y_limits)) {
  #       limits <- y_limits[[landleafn]]
  #       data_subset <- subset(data, landleaf == landleafn)
  #       p <- p + geom_blank(data = data_subset, aes(y = limits[1])) + geom_blank(data = data_subset, aes(y = limits[2]))
  #     }
  #   }
  # }
  
  # return(p)
}



#####################################################
create_time_series_plot_landtype <- function(data, title_suffix = "",title_main = "Time Series by Landleaf Type",y_title = "Value") {
 
  ggplot(data, aes(x = year, y = value, color = case)) +
    geom_line() +
    facet_wrap(~ landleaf, scales = "free_y") +
    scale_color_brewer(palette = "Dark2", type = "qual", 
                       limits = unique(data$case)) +
    theme_minimal() +
    labs(title = paste(title_main, title_suffix),
         x = "Year",
         y = y_title,
         color = "Case") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1),
          plot.title.position = "panel", # Ensures the title is at the top center
          panel.border = element_rect(color = "black", fill = NA, size = 1))
}

######################################################
create_time_series_plot <- function(data, title_suffix = "",title_main = "Time Series",y_title = "Value") {
    ggplot(data, aes(x = year, y = value, color = case)) +
    geom_line() +
    scale_color_brewer(palette = "Dark2", type = "qual", 
                       limits = unique(data$case)) +
    theme_minimal() +
    labs(title = paste(title_main, title_suffix),
         x = "Year",
         y = y_title,
         color = "Case") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1),
          plot.title.position = "panel", # Ensures the title is at the top center
          panel.border = element_rect(color = "black", fill = NA, size = 1))
}





  
#########################################
save_plot_in_formats <- function(plot, path, base_filename, case_name, width, height) {
  # Define the formats and their specific settings
  formats <- list(
    svg = list(ext = "svg", device = "svg", dpi = NULL),
    pdf = list(ext = "pdf", device = "pdf", dpi = NULL),
    png = list(ext = "png", device = "png", dpi = 300),
    tif = list(ext = "tif", device = "tiff", dpi = 300)
  )
  # Loop through each format and save the plot
  for (format in names(formats)) {
    file_path <- paste0(path, base_filename, case_name,"_",SSP_name, ".", formats[[format]]$ext)
    # Check if dpi is needed
    if (is.null(formats[[format]]$dpi)) {
      ggsave(
        file_path,
        plot = plot,
        width = width,
        height = height,
        device = formats[[format]]$device
      )
    } else {
      ggsave(
        file_path,
        plot = plot,
        width = width,
        height = height,
        dpi = formats[[format]]$dpi,
        device = formats[[format]]$device
      )
    }
  }
}

```
## plotting ############################################################

### agg land use ############################
only gfdl& agg land types
```{r S6 aggregated.land.allocation process 2 for plotting  SSP370 & SSP126 & SSP585}


  plot_var_name<-"aggregated.land.allocation"

###############################################
long_aggregated.land.allocation_SSP_combines <- aggregated.land.allocation_combines_s6%>%
  group_by(Units,scenario,landleaf,year)%>%
  summarise(across(ori:classic_gfdl_default_updateall, sum, na.rm = TRUE))%>%
  ungroup%>%
  pivot_longer(cols = ori:classic_gfdl_default_updateall, 
               names_to = "case", 
               values_to = "value")%>%
  distinct()



long_aggregated.land.allocation_SSP_combines_RCP_diff <- aggregated.land.allocation_combines_s6%>%
  group_by(Units,scenario,landleaf,year)%>%
  summarise(across(ori:classic_gfdl_default_updateall, sum, na.rm = TRUE))%>%
  ungroup%>%
  mutate(classic_gfdl_default_updateall_ori = classic_gfdl_default_updateall - ori,
         classic_gfdl_default_updateall_orifor_ori = classic_gfdl_default_updateall_orifor-ori
         )%>%
  dplyr::select(-c(5:7))%>%
  pivot_longer(cols = classic_gfdl_default_updateall_ori:classic_gfdl_default_updateall_orifor_ori, 
               names_to = "case", 
               values_to = "value")%>%
  distinct()

long_aggregated.land.allocation_SSP_combines_forrole_diff <- aggregated.land.allocation_combines_s6%>%
  group_by(Units,scenario,landleaf,year)%>%
  summarise(across(ori:classic_gfdl_default_updateall, sum, na.rm = TRUE))%>%
  ungroup%>%
  mutate(
         classic_gfdl_default_updateall_default_updateall_orifor = classic_gfdl_default_updateall - classic_gfdl_default_updateall_orifor
         )%>%
  dplyr::select(-c(5:7))%>%
  pivot_longer(cols = classic_gfdl_default_updateall_default_updateall_orifor:classic_gfdl_default_updateall_default_updateall_orifor, 
               names_to = "case", 
               values_to = "value")%>%
  distinct()

long_aggregated.land.allocation_SSP_combines_RCP_diff_re <- aggregated.land.allocation_combines_s6%>%
  group_by(Units,scenario,landleaf,year)%>%
  summarise(across(ori:classic_gfdl_default_updateall, sum, na.rm = TRUE))%>%
  ungroup%>%
  mutate(
    classic_gfdl_default_updateall_ori = if_else(ori == 0, 0, (classic_gfdl_default_updateall / ori) - 1),
    classic_gfdl_default_updateall_orifor_ori = if_else(ori == 0, 0, (classic_gfdl_default_updateall_orifor / ori) - 1)
         )%>%
  dplyr::select(-c(5:7))%>%
  pivot_longer(cols = classic_gfdl_default_updateall_ori:classic_gfdl_default_updateall_orifor_ori, 
               names_to = "case", 
               values_to = "value")%>%
  distinct()%>%
  mutate(value=value*100)

long_aggregated.land.allocation_SSP_combines_forrole_diff_re <- aggregated.land.allocation_combines_s6%>%
  group_by(Units,scenario,landleaf,year)%>%
  summarise(across(ori:classic_gfdl_default_updateall, sum, na.rm = TRUE))%>%
  ungroup%>%
  mutate(
    classic_gfdl_default_updateall_default_updateall_orifor = if_else(classic_gfdl_default_updateall_orifor == 0, 0, (classic_gfdl_default_updateall / classic_gfdl_default_updateall_orifor) - 1)
         )%>%
  dplyr::select(-c(5:7))%>%
  pivot_longer(cols = classic_gfdl_default_updateall_default_updateall_orifor:classic_gfdl_default_updateall_default_updateall_orifor, 
               names_to = "case", 
               values_to = "value")%>%
  distinct()%>%
  mutate(value=value*100)


#####################################################

```

```{r S5_1 function plot each land use fig first, then group them}
# Function to adjust y-axis limits by 0.1%
adjust_limits <- function(limits) {
  min_val <- limits[1]
  max_val <- limits[2]
  adjustment <- (max_val - min_val) * 0.001
  return(c(min_val - adjustment, max_val + adjustment))
}

# Original y_limits_list
y_limits_list <- list(
  "Cropland" = c(0, 1.1),
  "Biomass" = c(-1, 1.2),
  "Managed forest" = c(-19, 0),
  "Unmanaged forest" = c(-0.75, 3),
  "Managed pasture" = c(-1.5, 0.3),
  "Unmanaged pasture" = c(0, 3.5),
  "Grass" = c(-0.3, 2),
  "Shrubs" = c(-0.3, 1.5),
  "Other" = c(-0.1, 0.1)
)

adjusted_forre_y_limits_list <- lapply(y_limits_list, adjust_limits)

# if show x tick label list
show_x_tick_label_list <- list(
  "Cropland" = FALSE,
  "Biomass" =  FALSE,
  "Managed forest" =  FALSE,
  "Unmanaged forest" =  TRUE,
  "Managed pasture" =  FALSE,
  "Unmanaged pasture" = TRUE,
  "Grass" = FALSE,
  "Shrubs" = TRUE,
  "Other" = FALSE
)

# if show y title list
show_y_title_list <- list(
  "Cropland" = FALSE,
  "Biomass" =  FALSE,
  "Managed forest" =  TRUE,
  "Unmanaged forest" =  FALSE,
  "Managed pasture" =  FALSE,
  "Unmanaged pasture" = FALSE,
  "Grass" = FALSE,
  "Shrubs" = FALSE,
  "Other" = FALSE
)




#####################################################################
# Define the function to create individual plots
create_time_series_plot_landtype <- function(data,  y_title = "%", y_limits = NULL, show_legend = FALSE, show_y_title = FALSE,show_x_title = FALSE, show_x_ticks = FALSE) {
  p <- ggplot(data, aes(x = year, y = value, color = case)) +
    geom_line() +
    scale_color_brewer(palette = "Dark2", type = "qual", limits = unique(data$case)) +
    theme_minimal() +
    labs(title = paste(unique(data$landleaf)),
         x = "Year",
         y = if (show_y_title) y_title else NULL,
         color = if (show_legend) "Case" else NULL) +
    theme(
      plot.title.position = "plot", # Ensures the title is at the top center
      plot.title = element_text(hjust = 0.5, vjust = 0.5, size = 15),       # Adjust title font size and ensure it is centered
      panel.border = element_rect(color = "black", fill = NA, size = 1),
      legend.position = if (show_legend) "right" else "none",
      axis.title.y = if (show_y_title) element_text(size = 17) else element_blank(),
      axis.title.x = if (show_x_title) element_text(size = 17) else element_blank(), # Set x title font size
      axis.text.x = if (show_x_ticks) element_text(angle = 45, hjust = 1, vjust = 1, size = 15) else element_blank(), # Set x tick label font size
      axis.text.y = element_text(size = 15) 
    )
  
  if (!is.null(y_limits)) {
    p <- p + ylim(y_limits)
  }
  
  return(p)
}




```

```{r S7 use the processed data for plotting}

# Generate plots for each land type
plot_list <- lapply(unique(long_aggregated.land.allocation_SSP_combines_forrole_diff_re$landleaf), function(landleafn) {
  data_subset <- subset(long_aggregated.land.allocation_SSP_combines_forrole_diff_re, landleaf == landleafn)
  create_time_series_plot_landtype(data_subset,  y_title = "Global LULCC relative difference (%)", 
                                   show_x_title = show_x_tick_label_list[[landleafn]],
                                   show_x_ticks = show_x_tick_label_list[[landleafn]],
                                   show_y_title = show_y_title_list[[landleafn]],
                                   y_limits=adjusted_forre_y_limits_list[[landleafn]])
})

# Create a plot with the legend
legend_plot <- create_time_series_plot_landtype(
  subset(long_aggregated.land.allocation_SSP_combines_forrole_diff_re, landleaf == "Biomass"),
  show_legend = TRUE
)

# Extract and display the legend
legend <- get_legend(legend_plot)

# Combine the plots into a single figure
combined_plot <- wrap_plots(plot_list) +
  plot_annotation(title = paste("Combined", scenario_set, "for role relative Diff"))& theme(
    plot.title = element_text(hjust = 0.5, size = 18)       # Adjust title font size
    )


# Add margin on the right
spacer <- plot_spacer() + theme_void() # Create an empty plot as a spacer

# Arrange the combined plot, legend, and spacer
final_plot <- plot_grid(combined_plot, legend, spacer, ncol = 3, rel_widths = c(3, 1, 0.5))


g5 <- final_plot


# Use the function to create plot g1
g1 <- create_time_series_plot_landtype(long_aggregated.land.allocation_SSP_combines, "")

# Use the function to create plot g2
g2 <- create_time_series_plot_landtype(long_aggregated.land.allocation_SSP_combines_RCP_diff,  paste0("under",scenario_set,"Diff"))

g3 <- create_time_series_plot_landtype(long_aggregated.land.allocation_SSP_combines_RCP_diff_re,  paste0("under",scenario_set,"relative Diff"),y_title = "%")

g4 <- create_time_series_plot_landtype(long_aggregated.land.allocation_SSP_combines_forrole_diff,  paste0("under",scenario_set,"forrole Diff"))

# g5 <- create_time_series_plot_landtype_ylim(long_aggregated.land.allocation_SSP_combines_forrole_diff_re,  paste0("under",scenario_set,"forrole relative Diff"),y_title = "%",y_limits=adjusted_y_limits_list)


# Create the plot




# Print the plot
# print(p)
###################################
base_filename1 <- paste0("Fig3_",plot_var_name,"_",scenario_set,"_group_gfdl")
base_filename2 <- paste0("Fig3_",plot_var_name,"_",scenario_set,"_diff_group_withRCP_gfdl")
base_filename3 <- paste0("Fig3_",plot_var_name,"_",scenario_set,"_re_diff_group_withRCP_gfdl")
base_filename4 <- paste0("Fig3_",plot_var_name,"_",scenario_set,"_diff_group_forrole_gfdl")
base_filename5 <- paste0("Fig3_",plot_var_name,"_",scenario_set,"_re_diff_group_forrole_gfdl")
plot_width <- 29 * 0.5
plot_height<- 20 * 0.5

# Call the function
# save_plot_in_formats(
#   plot = g1,
#   path = paste0(figure_save_path,"LULCC_global/"),
#   base_filename = base_filename1,
#   case_name = version_name,
#   width = plot_width,
#   height = plot_height
# )
# 
# save_plot_in_formats(
#   plot = g2,
#   path = paste0(figure_save_path,"LULCC_global/"),
#   base_filename = base_filename2,
#   case_name = version_name,
#   width = plot_width,
#   height = plot_height
# )
# 
# save_plot_in_formats(
#   plot = g3,
#   path = paste0(figure_save_path,"LULCC_global/"),
#   base_filename = base_filename3,
#   case_name = version_name,
#   width = plot_width,
#   height = plot_height
# )
# 
# save_plot_in_formats(
#   plot = g4,
#   path = paste0(figure_save_path,"LULCC_global/"),
#   base_filename = base_filename4,
#   case_name = version_name,
#   width = plot_width,
#   height = plot_height
# )

save_plot_in_formats(
  plot = g5,
  path = paste0(figure_save_path,"LULCC_global/"),
  base_filename = base_filename5,
  case_name = version_name,
  width = plot_width,
  height = plot_height
)


```

plotting agg land use only for SSP585
```{r S8 aggregated.land.allocation plotting  SSP585}
if(scenario_set == "SSP585"){
###############################################
long_aggregated.land.allocation_SSP_combines <- aggregated.land.allocation_SSP_combines%>%
  group_by(Units,scenario,landleaf,year)%>%
  summarise(across(default_updateall:noRCP_ag_prodchange, sum, na.rm = TRUE))%>%
  ungroup%>%
  pivot_longer(cols = default_updateall:noRCP_ag_prodchange, 
               names_to = "case", 
               values_to = "value")%>%
  distinct()



long_aggregated.land.allocation_SSP_combines_RCP_diff <- aggregated.land.allocation_SSP_combines%>%
  group_by(Units,scenario,landleaf,year)%>%
  summarise(across(default_updateall:noRCP_ag_prodchange, sum, na.rm = TRUE))%>%
  ungroup%>%
  mutate(default_updateall_ori = default_updateall - ori,
         default_updateall_orifor_ori = default_updateall_orifor-ori,
         ori_ag_prodchange_ori = ori_ag_prodchange - ori,
         ori_ag_cost_ori = ori_ag_cost - ori
         )%>%
  dplyr::select(-c(5:12))%>%
  pivot_longer(cols = default_updateall_ori:ori_ag_cost_ori, 
               names_to = "case", 
               values_to = "value")%>%
  distinct()

long_aggregated.land.allocation_SSP_combines_forrole_diff <- aggregated.land.allocation_SSP_combines%>%
  group_by(Units,scenario,landleaf,year)%>%
  summarise(across(default_updateall:noRCP_ag_prodchange, sum, na.rm = TRUE))%>%
  ungroup%>%
  mutate(
         default_updateall_default_updateall_orifor = default_updateall - default_updateall_orifor
         
         )%>%
  dplyr::select(-c(5:12))%>%
  pivot_longer(cols = default_updateall_default_updateall_orifor, 
               names_to = "case", 
               values_to = "value")%>%
  distinct()

long_aggregated.land.allocation_SSP_combines_RCP_diff_re <- aggregated.land.allocation_SSP_combines%>%
  group_by(Units,scenario,landleaf,year)%>%
  summarise(across(default_updateall:noRCP_ag_prodchange, sum, na.rm = TRUE))%>%
  ungroup%>%
  mutate(
    default_updateall_ori = if_else(ori == 0, 0, (default_updateall / ori) - 1),
    default_updateall_orifor_ori = if_else(ori == 0, 0, (default_updateall_orifor / ori) - 1),
    ori_ag_prodchange_ori = if_else(ori == 0, NA_real_, (ori_ag_prodchange / ori) - 1),
    ori_ag_cost_ori = if_else(ori == 0, NA_real_, (ori_ag_cost / ori) - 1)
         )%>%
  dplyr::select(-c(5:12))%>%
  pivot_longer(cols = default_updateall_ori:ori_ag_cost_ori, 
               names_to = "case", 
               values_to = "value")%>%
  distinct()

long_aggregated.land.allocation_SSP_combines_forrole_diff_re <- aggregated.land.allocation_SSP_combines%>%
  group_by(Units,scenario,landleaf,year)%>%
  summarise(across(default_updateall:noRCP_ag_prodchange, sum, na.rm = TRUE))%>%
  ungroup%>%
  mutate(
    default_updateall_default_updateall_orifor = if_else(default_updateall_orifor == 0, 0, (default_updateall / default_updateall_orifor) - 1)
         )%>%
  dplyr::select(-c(5:12))%>%
  pivot_longer(cols = default_updateall_default_updateall_orifor, 
               names_to = "case", 
               values_to = "value")%>%
  distinct()


#####################################################
# Use the function to create plot g1
g1 <- create_time_series_plot_landtype(long_aggregated.land.allocation_SSP_combines, "")

# Use the function to create plot g2
g2 <- create_time_series_plot_landtype(long_aggregated.land.allocation_SSP_combines_RCP_diff, "with 8p5 Diff")

g3 <- create_time_series_plot_landtype(long_aggregated.land.allocation_SSP_combines_RCP_diff_re, "with 8p5 relative Diff")

g4 <- create_time_series_plot_landtype(long_aggregated.land.allocation_SSP_combines_forrole_diff, "585 forrole Diff")

g5 <- create_time_series_plot_landtype(long_aggregated.land.allocation_SSP_combines_forrole_diff_re, "585 forrole relative Diff")



###################################
base_filename1 <- "Fig1_agg_LULCC_time series_each type_group"
base_filename2 <- "Fig2_agg_LULCC_time series_each type_diff_group_withRCP"
base_filename3 <- "Fig2_agg_LULCC_time series_each type_re_diff_group_withRCP"
base_filename4 <- "Fig2_agg_LULCC_time series_each type_diff_group_forrole"
base_filename5 <- "Fig2_agg_LULCC_time series_each type_re_diff_group_forrole"
plot_width <- 25 * 0.5
plot_height<- 20 * 0.5

# Call the function
save_plot_in_formats(
  plot = g1,
  path = figure_save_path,
  base_filename = base_filename1,
  case_name = version_name,
  width = plot_width,
  height = plot_height
)

save_plot_in_formats(
  plot = g2,
  path = figure_save_path,
  base_filename = base_filename2,
  case_name = version_name,
  width = plot_width,
  height = plot_height
)

save_plot_in_formats(
  plot = g3,
  path = figure_save_path,
  base_filename = base_filename3,
  case_name = version_name,
  width = plot_width,
  height = plot_height
)

save_plot_in_formats(
  plot = g4,
  path = figure_save_path,
  base_filename = base_filename4,
  case_name = version_name,
  width = plot_width,
  height = plot_height
)

save_plot_in_formats(
  plot = g5,
  path = figure_save_path,
  base_filename = base_filename5,
  case_name = version_name,
  width = plot_width,
  height = plot_height
)
}

```
### total climate forcing ###################
only gfdl
```{r S9 total.climate.forcing_SSP_combines plotting SSP370&SSP126& SSP585}



plot_var_name<-"total.climate.forcing"

###############################################
long_total.climate.forcing_SSP_combines <- total.climate.forcing_SSP_combines%>%
  group_by(Units,scenario,year)%>%
   ### update this when there are more sub_scenario (e.g. all update_except forest) finished
  summarise(across(ori:classic_gfdl_default_updateall, sum, na.rm = TRUE))%>%
  ungroup%>%
  ### update this when there are more sub_scenario (e.g. all update_except forest) finished
  pivot_longer(cols = ori:classic_gfdl_default_updateall, 
               names_to = "case", 
               values_to = "value")%>%
  distinct()



long_total.climate.forcing_SSP_combines_RCP_diff <- total.climate.forcing_SSP_combines%>%
  group_by(Units,scenario,year)%>%
   ### update this when there are more sub_scenario (e.g. all update_except forest) finished
  summarise(across(ori:classic_gfdl_default_updateall, sum, na.rm = TRUE))%>%
  ungroup%>%
   ### update this when there are more sub_scenario (e.g. all update_except forest) finished
  mutate(classic_gfdl_default_updateall_ori = classic_gfdl_default_updateall - ori,
         classic_gfdl_default_updateall_orifor_ori = classic_gfdl_default_updateall_orifor-ori
         )%>%
  ### update this when there are more sub_scenario (e.g. all update_except forest) finished
  dplyr::select(-c(4:6))%>%
  ### update this when there are more sub_scenario (e.g. all update_except forest) finished
  pivot_longer(cols = classic_gfdl_default_updateall_ori:classic_gfdl_default_updateall_orifor_ori, 
               names_to = "case", 
               values_to = "value")%>%
  distinct()

long_total.climate.forcing_SSP_combines_forrole_diff <- total.climate.forcing_SSP_combines%>%
  group_by(Units,scenario,year)%>%
  summarise(across(ori:classic_gfdl_default_updateall, sum, na.rm = TRUE))%>%
  ungroup%>%
  mutate(
         classic_gfdl_default_updateall_classic_gfdl_default_updateall_orifor = classic_gfdl_default_updateall - classic_gfdl_default_updateall_orifor
         )%>%
  dplyr::select(-c(4:6))%>%
  pivot_longer(cols = classic_gfdl_default_updateall_classic_gfdl_default_updateall_orifor:classic_gfdl_default_updateall_classic_gfdl_default_updateall_orifor,
               names_to = "case",
               values_to = "value")%>%
  distinct()

long_total.climate.forcing_SSP_combines_RCP_diff_re <- total.climate.forcing_SSP_combines%>%
  group_by(Units,scenario,year)%>%
  ### update this when there are more sub_scenario (e.g. all update_except forest) finished
  summarise(across(ori:classic_gfdl_default_updateall, sum, na.rm = TRUE))%>%
  ungroup%>%
  mutate(
    classic_gfdl_default_updateall_ori = if_else(ori == 0, 0, (classic_gfdl_default_updateall / ori) - 1),
    classic_gfdl_default_updateall_orifor_ori = if_else(ori == 0, 0, (classic_gfdl_default_updateall_orifor / ori) - 1)
         )%>%
  ### update this when there are more sub_scenario (e.g. all update_except forest) finished
  dplyr::select(-c(4:6))%>%
  ### update this when there are more sub_scenario (e.g. all update_except forest) finished
  pivot_longer(cols = classic_gfdl_default_updateall_ori:classic_gfdl_default_updateall_orifor_ori, 
               names_to = "case", 
               values_to = "value")%>%
  distinct()

long_total.climate.forcing_SSP_combines_forrole_diff_re <- total.climate.forcing_SSP_combines%>%
  group_by(Units,scenario,year)%>%
  summarise(across(ori:classic_gfdl_default_updateall, sum, na.rm = TRUE))%>%
  ungroup%>%
  mutate(
    classic_gfdl_default_updateall_classic_gfdl_default_updateall_orifor = if_else(classic_gfdl_default_updateall_orifor == 0, 0, (classic_gfdl_default_updateall / classic_gfdl_default_updateall_orifor) - 1)
    )%>%
  dplyr::select(-c(4:6))%>%
  pivot_longer(cols = classic_gfdl_default_updateall_classic_gfdl_default_updateall_orifor:classic_gfdl_default_updateall_classic_gfdl_default_updateall_orifor,
               names_to = "case",
               values_to = "value")%>%
  distinct()


#####################################################
# Use the function to create plot g1
g1 <-
  create_time_series_plot(
    long_total.climate.forcing_SSP_combines,
    title_main = "Time Series",
    y_title = "Total climate forcing",
    title_suffix = "of total climate forcing"
  )

# Use the function to create plot g2
g2 <-
  create_time_series_plot(
    long_total.climate.forcing_SSP_combines_RCP_diff,
    title_main = "Time Series",
    y_title = "Total climate forcing",
    title_suffix = paste0("under",scenario_set,"Diff")
  )

g3 <-
  create_time_series_plot(
    long_total.climate.forcing_SSP_combines_RCP_diff_re,
    title_main = "Time Series",
    y_title = "Total climate forcing",
    title_suffix = paste0("under",scenario_set,"relative Diff")
  )

g4 <-
create_time_series_plot(
    long_total.climate.forcing_SSP_combines_forrole_diff,
    title_main = "Time Series",
    y_title = "Total climate forcing",
    title_suffix = paste0("under",scenario_set,"forrole Diff")
  )

g5 <-
  create_time_series_plot(
    long_total.climate.forcing_SSP_combines_forrole_diff_re,
    title_main = "Time Series",
    y_title = "Total climate forcing",
    title_suffix = paste0("under",scenario_set,"forrole relative Diff")
  ) 



###################################
base_filename1 <- paste0("Fig3_",plot_var_name,"_",scenario_set,"_group_gfdl")
base_filename2 <- paste0("Fig3_",plot_var_name,"_",scenario_set,"_diff_group_withRCP_gfdl")
base_filename3 <- paste0("Fig3_",plot_var_name,"_",scenario_set,"_re_diff_group_withRCP_gfdl")
base_filename4 <- paste0("Fig3_",plot_var_name,"_",scenario_set,"_diff_group_forrole_gfdl")
base_filename5 <- paste0("Fig3_",plot_var_name,"_",scenario_set,"_re_diff_group_forrole_gfdl")
plot_width <- 25 * 0.25
plot_height<- 20 * 0.25



# Call the function
save_plot_in_formats(
  plot = g1,
  path = paste0(figure_save_path,"total forcing/"),
  base_filename = base_filename1,
  case_name = version_name,
  width = plot_width,
  height = plot_height
)

save_plot_in_formats(
  plot = g2,
  path = paste0(figure_save_path,"total forcing/"),
  base_filename = base_filename2,
  case_name = version_name,
  width = plot_width,
  height = plot_height
)

save_plot_in_formats(
  plot = g3,
  path = paste0(figure_save_path,"total forcing/"),
  base_filename = base_filename3,
  case_name = version_name,
  width = plot_width,
  height = plot_height
)

save_plot_in_formats(
  plot = g4,
  path = paste0(figure_save_path,"total forcing/"),
  base_filename = base_filename4,
  case_name = version_name,
  width = plot_width,
  height = plot_height
)

save_plot_in_formats(
  plot = g5,
  path = paste0(figure_save_path,"total forcing/"),
  base_filename = base_filename5,
  case_name = version_name,
  width = plot_width,
  height = plot_height
)


```
both gfdl and ukesm
```{r S10 total.climate.forcing_SSP_combines plotting SSP370&SSP126}
# total.climate.forcing_SSP_combines<-read.csv(paste0(figure_save_path,"total.climate.forcing_",scenario_set,"_combines.csv"))#,row.names = "FALSE"

#if(scenario_set == "SSP370"){
if(scenario_set %in% c("SSP126","SSP370")){
plot_var_name<-"total.climate.forcing"

###############################################
long_total.climate.forcing_SSP_combines <- total.climate.forcing_SSP_combines%>%
  group_by(Units,scenario,year)%>%
   ### update this when there are more sub_scenario (e.g. all update_except forest) finished
  summarise(across(ori:classic_ukesm_default_updateall, sum, na.rm = TRUE))%>%
  ungroup%>%
  ### update this when there are more sub_scenario (e.g. all update_except forest) finished
  pivot_longer(cols = ori:classic_ukesm_default_updateall, 
               names_to = "case", 
               values_to = "value")%>%
  distinct()



long_total.climate.forcing_SSP_combines_RCP_diff <- total.climate.forcing_SSP_combines%>%
  group_by(Units,scenario,year)%>%
   ### update this when there are more sub_scenario (e.g. all update_except forest) finished
  summarise(across(ori:classic_ukesm_default_updateall, sum, na.rm = TRUE))%>%
  ungroup%>%
   ### update this when there are more sub_scenario (e.g. all update_except forest) finished
  mutate(classic_gfdl_default_updateall_ori = classic_gfdl_default_updateall - ori,
         classic_gfdl_default_updateall_orifor_ori = classic_gfdl_default_updateall_orifor-ori,
         classic_ukesm_default_updateall_ori = classic_ukesm_default_updateall - ori,
         classic_ukesm_default_updateall_orifor_ori = classic_ukesm_default_updateall_orifor-ori,
         
         )%>%
  ### update this when there are more sub_scenario (e.g. all update_except forest) finished
  dplyr::select(-c(4:8))%>%
  ### update this when there are more sub_scenario (e.g. all update_except forest) finished
  pivot_longer(cols = classic_gfdl_default_updateall_ori:classic_ukesm_default_updateall_orifor_ori, 
               names_to = "case", 
               values_to = "value")%>%
  distinct()

long_total.climate.forcing_SSP_combines_forrole_diff <- total.climate.forcing_SSP_combines%>%
  group_by(Units,scenario,year)%>%
  summarise(across(ori:classic_ukesm_default_updateall, sum, na.rm = TRUE))%>%
  ungroup%>%
  mutate(
         classic_gfdl_default_updateall_classic_gfdl_default_updateall_orifor = classic_gfdl_default_updateall - classic_gfdl_default_updateall_orifor,
         classic_ukesm_default_updateall_classic_ukesm_default_updateall_orifor = classic_ukesm_default_updateall - classic_ukesm_default_updateall_orifor

         )%>%
  dplyr::select(-c(4:8))%>%
  pivot_longer(cols = classic_gfdl_default_updateall_classic_gfdl_default_updateall_orifor:classic_ukesm_default_updateall_classic_ukesm_default_updateall_orifor,
               names_to = "case",
               values_to = "value")%>%
  distinct()

long_total.climate.forcing_SSP_combines_RCP_diff_re <- total.climate.forcing_SSP_combines%>%
  group_by(Units,scenario,year)%>%
  ### update this when there are more sub_scenario (e.g. all update_except forest) finished
  summarise(across(ori:classic_ukesm_default_updateall, sum, na.rm = TRUE))%>%
  ungroup%>%
  mutate(
    classic_gfdl_default_updateall_ori = if_else(ori == 0, 0, (classic_gfdl_default_updateall / ori) - 1),
    classic_gfdl_default_updateall_orifor_ori = if_else(ori == 0, 0, (classic_gfdl_default_updateall_orifor / ori) - 1),
    classic_ukesm_default_updateall_ori = if_else(ori == 0, 0, (classic_ukesm_default_updateall / ori) - 1),
    classic_ukesm_default_updateall_orifor_ori = if_else(ori == 0, 0, (classic_ukesm_default_updateall_orifor / ori) - 1)
         )%>%
  ### update this when there are more sub_scenario (e.g. all update_except forest) finished
  dplyr::select(-c(4:8))%>%
  ### update this when there are more sub_scenario (e.g. all update_except forest) finished
  pivot_longer(cols = classic_gfdl_default_updateall_ori:classic_ukesm_default_updateall_orifor_ori, 
               names_to = "case", 
               values_to = "value")%>%
  distinct()

long_total.climate.forcing_SSP_combines_forrole_diff_re <- total.climate.forcing_SSP_combines%>%
  group_by(Units,scenario,year)%>%
  summarise(across(ori:classic_ukesm_default_updateall, sum, na.rm = TRUE))%>%
  ungroup%>%
  mutate(
    classic_gfdl_default_updateall_classic_gfdl_default_updateall_orifor = if_else(classic_gfdl_default_updateall_orifor == 0, 0, (classic_gfdl_default_updateall / classic_gfdl_default_updateall_orifor) - 1),
    classic_ukesm_default_updateall_classic_ukesm_default_updateall_orifor = if_else(classic_ukesm_default_updateall_orifor == 0, 0, (classic_ukesm_default_updateall / classic_ukesm_default_updateall_orifor) - 1)
         )%>%
  dplyr::select(-c(4:8))%>%
  pivot_longer(cols = classic_gfdl_default_updateall_classic_gfdl_default_updateall_orifor:classic_ukesm_default_updateall_classic_ukesm_default_updateall_orifor,
               names_to = "case",
               values_to = "value")%>%
  distinct()


#####################################################
# Use the function to create plot g1
g1 <-
  create_time_series_plot(
    long_total.climate.forcing_SSP_combines,
    title_main = "Time Series",
    y_title = "Total climate forcing",
    title_suffix = "of total climate forcing"
  )

# Use the function to create plot g2
g2 <-
  create_time_series_plot(
    long_total.climate.forcing_SSP_combines_RCP_diff,
    title_main = "Time Series",
    y_title = "Total climate forcing",
    title_suffix = paste0("under",scenario_set,"Diff")
  )

g3 <-
  create_time_series_plot(
    long_total.climate.forcing_SSP_combines_RCP_diff_re,
    title_main = "Time Series",
    y_title = "Total climate forcing",
    title_suffix = paste0("under",scenario_set,"relative Diff")
  )

g4 <-
create_time_series_plot(
    long_total.climate.forcing_SSP_combines_forrole_diff,
    title_main = "Time Series",
    y_title = "Total climate forcing",
    title_suffix = paste0("under",scenario_set,"forrole Diff")
  )

g5 <-
  create_time_series_plot(
    long_total.climate.forcing_SSP_combines_forrole_diff_re,
    title_main = "Time Series",
    y_title = "Total climate forcing",
    title_suffix = paste0("under",scenario_set,"forrole relative Diff")
  ) 



###################################
base_filename1 <- paste0("Fig3_",plot_var_name,"_",scenario_set,"_group")
base_filename2 <- paste0("Fig3_",plot_var_name,"_",scenario_set,"_diff_group_withRCP")
base_filename3 <- paste0("Fig3_",plot_var_name,"_",scenario_set,"_re_diff_group_withRCP")
base_filename4 <- paste0("Fig3_",plot_var_name,"_",scenario_set,"_diff_group_forrole")
base_filename5 <- paste0("Fig3_",plot_var_name,"_",scenario_set,"_re_diff_group_forrole")
plot_width <- 25 * 0.5
plot_height<- 20 * 0.5



# Call the function
save_plot_in_formats(
  plot = g1,
  path = figure_save_path,
  base_filename = base_filename1,
  case_name = version_name,
  width = plot_width,
  height = plot_height
)

save_plot_in_formats(
  plot = g2,
  path = figure_save_path,
  base_filename = base_filename2,
  case_name = version_name,
  width = plot_width,
  height = plot_height
)

save_plot_in_formats(
  plot = g3,
  path = figure_save_path,
  base_filename = base_filename3,
  case_name = version_name,
  width = plot_width,
  height = plot_height
)

save_plot_in_formats(
  plot = g4,
  path = figure_save_path,
  base_filename = base_filename4,
  case_name = version_name,
  width = plot_width,
  height = plot_height
)

save_plot_in_formats(
  plot = g5,
  path = figure_save_path,
  base_filename = base_filename5,
  case_name = version_name,
  width = plot_width,
  height = plot_height
)

}
```
## old
```{r 11 read input table old}
# total.climate.forcing_SSP_combines<-read.csv(paste0(figure_save_path,"total.climate.forcing_",scenario_set,"_combines.csv"))%>%
#   dplyr::select(-X)
# 
# aggregated.land.allocation_SSP_combines<-read.csv(paste0(figure_save_path,"aggregated.land.allocation_",scenario_set,"_combines.csv"))%>%
#   dplyr::select(-X)
# 
# # aggregated.land.allocation_SSP_combines_agg<-aggregated.land.allocation_SSP_combines
# 
# ## agg cropland ###############################################################
# cropland_df <- aggregated.land.allocation_SSP_combines %>%
#   filter(landleaf == "crops" | landleaf == "otherarable")
# 
# # Next, group by the "year" column and summarize the values for each year
# cropland_sum <- cropland_df %>%
#   group_by(Units,scenario,region,year) %>%
#   summarize(across(ori:classic_ukesm_default_updateall, sum))
# 
# # Rename the landleaf of the sum as "cropland"
# cropland_sum$landleaf <- "Cropland"
# cropland_sum<-cropland_sum%>%select(Units,scenario,region, year, landleaf,everything())
# 
# # Append the cropland sum to the original dataframe
# aggregated.land.allocation_combines_s2 <- rbind(aggregated.land.allocation_SSP_combines, cropland_sum)
# 
# # Finally, remove the original "Crops" and "Other arable land" rows from the dataframe
# aggregated.land.allocation_combines_s2 <- aggregated.land.allocation_combines_s2 %>%
#   filter(landleaf != "crops" & landleaf != "otherarable")%>%
#   arrange(Units,scenario,region, landleaf, year)
# ##agg forest########################################################################
# # First, filter the dataframe to include only rows with "cropland" and "other arable land"
# mforest_df <- aggregated.land.allocation_combines_s2 %>%
#   filter(landleaf == "Softwood_Forest" | landleaf == "Hardwood_Forest")
# 
# # Next, group by the "year" column and summarize the values for each year
# mforest_sum <- mforest_df %>%
#   group_by(Units,scenario,region,year) %>%
#   summarize(across(ori:classic_ukesm_default_updateall, sum))
# 
# # Rename the landleaf of the sum as "cropland"
# mforest_sum$landleaf <- "Managed forest"
# mforest_sum<-mforest_sum%>%select(Units,scenario,region, year, landleaf,everything())
# 
# # Append the cropland sum to the original dataframe
# aggregated.land.allocation_combines_s3 <- rbind(aggregated.land.allocation_combines_s2, mforest_sum)
# 
# # Finally, remove the original "Crops" and "Other arable land" rows from the dataframe
# aggregated.land.allocation_combines_s3 <- aggregated.land.allocation_combines_s3 %>%
#   filter(landleaf != "Softwood_Forest" & landleaf != "Hardwood_Forest")%>%
#   arrange(Units,scenario,region, landleaf, year)
# ################################################
# ## sum hardwood and UnmanagedHardwood_Forest and together 
# # First, filter the dataframe to include only rows with "cropland" and "other arable land"
# umforest_df <- aggregated.land.allocation_combines_s3 %>%
#   filter(landleaf == "UnmanagedSoftwood_Forest" | landleaf == "UnmanagedHardwood_Forest")
# 
# # Next, group by the "year" column and summarize the values for each year
# umforest_sum <- umforest_df %>%
#   group_by(Units,scenario,region,year) %>%
#   summarize(across(ori:classic_ukesm_default_updateall, sum))
# 
# # Rename the landleaf of the sum as "cropland"
# umforest_sum$landleaf <- "Unmanaged forest"
# umforest_sum<-umforest_sum%>%select(Units,scenario,region, year, landleaf,everything())
# 
# # Append the cropland sum to the original dataframe
# aggregated.land.allocation_combines_s4 <- rbind(aggregated.land.allocation_combines_s3, umforest_sum)
# 
# # Finally, remove the original "Crops" and "Other arable land" rows from the dataframe
# aggregated.land.allocation_combines_s4 <- aggregated.land.allocation_combines_s4 %>%
#   filter(landleaf != "UnmanagedSoftwood_Forest" & landleaf != "UnmanagedHardwood_Forest")
# 
# ################################################
# ## sum all the unchanged land use type 
# # First, filter the dataframe to include only rows with "cropland" and "other arable land"
# other_df <- aggregated.land.allocation_combines_s4 %>%
#   filter(landleaf == "rock and desert" | landleaf == "urban"| landleaf == "tundra")
# 
# # Next, group by the "year" column and summarize the values for each year
# other_sum <- other_df %>%
#   group_by(Units,scenario,region,year) %>%
#   summarize(across(ori:classic_ukesm_default_updateall, sum))
# 
# # Rename the landleaf of the sum as "cropland"
# other_sum$landleaf <- "Other"
# other_sum<-other_sum%>%select(Units,scenario,region, year, landleaf,everything())
# 
# # Append the cropland sum to the original dataframe
# aggregated.land.allocation_combines_s5 <- rbind(aggregated.land.allocation_combines_s4, other_sum)
# 
# # Finally, remove the original "Crops" and "Other arable land" rows from the dataframe
# aggregated.land.allocation_combines_s5 <- aggregated.land.allocation_combines_s5 %>%
#   filter(landleaf != "rock and desert" & landleaf != "urban"& landleaf != "tundra")
# #####################################################################################
# aggregated.land.allocation_combines_s5 <- aggregated.land.allocation_combines_s5 %>%
#   mutate(landleaf = gsub("pasture \\(other\\)", "Unmanaged pasture", landleaf))%>%
#   mutate(landleaf = gsub("pasture \\(grazed\\)", "Managed pasture", landleaf))%>%
#   mutate(landleaf = gsub("grass", "Grass", landleaf))%>%
#   mutate(landleaf = gsub("shrub", "Shrub", landleaf))%>%
#   mutate(landleaf = gsub("biomass", "Biomass", landleaf))


```